<!-- Page Header with Gradient -->
<header class="trip-header">
  <h1>Create a New Trip</h1>
  <p class="subtitle">Plan the journey, share the adventure.</p>
  <div class="header-gradient"></div>
</header>

<hr
  style="
    border: 0;
    height: 5px;
    background: linear-gradient(to right, #ac3457, #1e274e);
    margin: 20px 0;
  "
/>

<div class="container" [@slideInFromTop]>
  <section class="first-trip-section">
    <div class="row-combined">
      <div class="input-group trip-section">
        <h2>1. Trip Name üìù</h2>
        <label for="trip-name">What should we call your trip?</label>
        <input
          id="trip-name"
          type="text"
          placeholder="e.g., Euro Summer 2025"
        />
      </div>

      <div class="input-group trip-section">
        <h2>2. Travel Dates üìÖ</h2>
        <label for="start-date">When will the trip happen?</label>

        <div class="date-inputs">
          <div>
            <label for="start-date">Start Date</label>
            <input id="start-date" type="date" />
          </div>

          <div>
            <label for="end-date">End Date</label>
            <input id="end-date" type="date" />
          </div>
        </div>
      </div>

      <div class="input-group trip-section">
        <h2 class="section-title">3. Trip Emoji üé®</h2>

        <label for="trip-emoji" class="emoji-label-text">
          Choose an emoji that captures the vibe:
        </label>
        <div class="emoji-picker">
          <!-- Emoji Picker Button now placed under the label -->
          <div class="emoji-picker-wrapper">
            <button type="button" class="emoji-button selected-display">
              <span class="emoji-symbol">
                {{ getSelectedEmoji()?.symbol || "üé®" }}
              </span>
              <span class="emoji-label">
                {{ getSelectedEmoji()?.label || "Pick Emoji" }}
              </span>
            </button>

            <div class="emoji-grid-popup">
              <button
                *ngFor="let emoji of emojiOptions"
                type="button"
                class="emoji-button"
                [class.selected]="emoji.id === selectedEmojiId"
                (click)="selectEmoji(emoji.id)"
              >
                <span class="emoji-symbol">{{ emoji.symbol }}</span>
                <span class="emoji-label">{{ emoji.label }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="first-trip-section">
    <div class="row-combined">
      <div class="input-group trip-section">
        <h2>4. Invite Friends üë•</h2>
        <div class="pagination-controls">
          <button (click)="prevPage()" [disabled]="pageNumber === 0">
            ‚¨ÖÔ∏è Prev
          </button>
          <span>Page {{ pageNumber + 1 }} of {{ totalPages }}</span>
          <button
            (click)="nextPage()"
            [disabled]="pageNumber + 1 >= totalPages"
          >
            Next ‚û°Ô∏è
          </button>
          <div>
            <label for="pageInput" class="sr-only">Go to page:</label>
            <input
              id="pageInput"
              type="number"
              [(ngModel)]="pageInput"
              [min]="1"
              [max]="totalPages"
              (blur)="jumpToPage()"
              [attr.max]="totalPages"
            />
          </div>
        </div>

        <table class="friends-table">
          <thead>
            <tr>
              <th class="actions-header"><input type="checkbox" /> Invite</th>
              <th>üñºÔ∏è</th>
              <th>üë§ Username</th>
              <th class="email-header">üìß Email</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let friend of friends">
              <td class="actions-cell">
                <input type="checkbox" [value]="friend.id" />
              </td>
              <td>
                <img
                  [src]="friend.gender === 'M' ? 'm.png' : 'w.png'"
                  alt="avatar"
                  width="30"
                  height="30"
                  class="avatar"
                />
              </td>
              <td>{{ friend.username }}</td>
              <td class="email-cell">{{ friend.email }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <style>
        /* Existing styles ... */

        /* Cool and Compact Friends Table Styling */
        .friends-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 15px;
          font-size: 0.9rem; /* Slightly smaller font for compactness */
        }

        .friends-table th,
        .friends-table td {
          padding: 8px 10px; /* Reduced padding for compactness, but still breathable */
          border-bottom: 1px solid #eee; /* Light grey subtle border */
          text-align: left;
          white-space: nowrap; /* Prevent text wrapping for single-line display */
          overflow: hidden; /* Hide overflowing text */
          text-overflow: ellipsis; /* Indicate overflow with an ellipsis */
        }

        .friends-table th {
          background-color: #f8f8f8; /* Light background for header */
          color: #555;
          font-weight: bold;
        }

        .friends-table tbody tr:nth-child(even) {
          background-color: #f2f2f2; /* Slightly different background for even rows */
        }

        .friends-table tbody tr:hover {
          background-color: #e0f7fa; /* Subtle hover effect */
          transition: background-color 0.3s ease;
        }

        .avatar {
          border-radius: 50%; /* Circular avatars for a cool look */
          vertical-align: middle; /* Align avatar with text */
          margin-right: 8px;
        }

        /* Actions Header and Cell */
        .actions-header {
          width: 80px; /* Adjust width as needed */
          text-align: center;
        }

        .actions-cell {
          text-align: center;
        }

        .actions-header input[type="checkbox"],
        .actions-cell input[type="checkbox"] {
          margin-right: 5px;
          vertical-align: middle;
        }

        /* Adjust column widths for compactness */
        .email-header,
        .email-cell {
          width: 40%; /* Allow more space for potentially longer emails */
        }

        .friends-table th:nth-child(2), /* Avatar header */
        .friends-table td:nth-child(2) {
          /* Avatar cell */
          width: 40px; /* Fixed width for avatar column */
          text-align: center;
        }

        .friends-table th:nth-child(3), /* Username header */
        .friends-table td:nth-child(3) {
          /* Username cell */
          width: 30%; /* Allocate remaining space for username */
        }
      </style>

      <div class="input-group trip-section">
        <h2>5. Trip Notes üìù</h2>
        <label for="trip-notes"
          >Add ideas, links, or a short description:</label
        >
        <textarea id="trip-notes" placeholder="Optional notes..."></textarea>
      </div>
    </div>
  </section>

  <section class="trip-section">
    <h2>6. Add Stops üó∫Ô∏è</h2>
    <div class="map-info">
      <app-place-autocomplete
        (placeChanged)="onPlaceChanged($event)"
        placeholder="Type a city or address..."
      ></app-place-autocomplete>

      <div class="stops-row">
        <!-- Table: 1/3 width -->
        <div class="stops-table">
          <h3>Your Itinerary</h3>
          <table *ngIf="fromPlaces.length > 0">
            <thead>
              <tr>
                <th>Location</th>
                <th>Reorder / Remove</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let place of fromPlaces; let i = index">
                <td>{{ place.address }}</td>
                <td>
                  <button (click)="moveUp(i)" [disabled]="i === 0">‚¨Ü</button>
                  <button
                    (click)="moveDown(i)"
                    [disabled]="i === fromPlaces.length - 1"
                  >
                    ‚¨á
                  </button>
                  <button (click)="deletePlace(i)">üóëÔ∏è</button>
                </td>
              </tr>
            </tbody>
          </table>
          <p *ngIf="fromPlaces.length === 0">
            No stops added yet. Start by entering a destination.
          </p>
        </div>

        <!-- Map: 2/3 width -->
        <div class="map-container">
          <h3>Map Preview</h3>
          <google-map
            height="400px"
            width="100%"
            [zoom]="zoomLevel"
            [center]="mapCenter"
          >
            <map-marker
              *ngFor="let place of fromPlaces"
              [position]="{
                lat: place.location?.lat()!,
                lng: place.location?.lng()!
              }"
              [title]="place.name || place.address"
            ></map-marker>

            <map-directions-renderer
              *ngIf="directions$ | async as directions"
              [directions]="directions"
            ></map-directions-renderer>
          </google-map>
        </div>
      </div>
    </div>
  </section>
</div>

<style>
  /* General Styling */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }
  .date-inputs {
    display: flex;
    gap: 20px;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .input-group.trip-section textarea {
    resize: vertical;
    width: 100%;
    height: 100%;
    min-height: 150px;
    padding: 10px;
    font-size: 0.95rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    overflow: auto;
    box-sizing: border-box;
  }
  .date-inputs > div {
    display: flex;
    flex-direction: column;
  }

  /* Header Styling */
  .trip-header {
    text-align: center;
    margin-bottom: -10px;
  }

  .trip-header h1 {
    font-size: 2.2rem;
    background: linear-gradient(to right, #ac3457, #1e274e);
    -webkit-background-clip: text;
    color: transparent;
    font-weight: 700;
  }

  .trip-header .subtitle {
    font-size: 1.1rem;
    color: #666;
    margin: 10px 0 15px;
    font-style: italic;
  }

  /* Container */
  .container {
    margin: 0 auto;
    padding: 20px;
    background-color: #e6dbdb;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  /* Section Styles */
  h2 {
    font-size: 1.3rem;
    color: #4b3f72;
    font-weight: 600;
    margin-bottom: 10px;
  }

  h3 {
    font-size: 1.1rem;
    color: #34495e;
    margin-top: 15px;
  }

  .trip-section {
    margin-bottom: 25px;
    padding: 20px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  }

  .first-trip-section {
    margin-bottom: 10px;
    border-radius: 12px;
  }

  /* Layout Helpers */
  .row-combined {
    display: flex;
    gap: 40px;
    flex-wrap: wrap;
  }

  .row-combined .input-group {
    flex: 1;
    min-width: 220px;
  }

  .input-group {
    margin-bottom: 15px;
    text-align: left;
    display: flex;
    flex-direction: column;
  }

  /* Inputs */
  input[type="text"],
  input[type="date"] {
    padding: 8px 12px;
    margin-top: 5px;
    font-size: 0.95rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    width: 100%;
    max-width: 300px;
  }

  input[type="color"] {
    margin-top: 10px;
    height: 40px;
    width: 80px;
    border: none;
    cursor: pointer;
  }

  label {
    font-size: 1rem;
    color: #555;
  }

  button {
    padding: 6px 12px;
    margin-right: 5px;
    background-color: #6c5ce7;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  button:disabled {
    background-color: #bbb;
    cursor: not-allowed;
  }

  /* Table */
  table {
    width: 100%;
    margin-top: 15px;
    border-collapse: collapse;
  }

  th,
  td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }

  /* Map Styling */
  .map-container {
    margin-top: 20px;
  }

  .stops-row {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .stops-table {
    flex: 1;
    min-width: 280px;
  }

  .map-container {
    flex: 2;
    min-width: 300px;
  }

  /* Existing styles remain */

  /* Emoji Picker Styling - Updated */
  .emoji-picker {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    flex-wrap: wrap;
  }

  /* Wrapper around the emoji button and grid */
  .emoji-picker-wrapper {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Emoji Button (Trigger) */
  .emoji-button.selected-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    font-size: 1.2rem;
    background-color: #f4f4f4; /* Greish background */
    border: 1px solid #ccc;
    border-radius: 10px;
    cursor: pointer;
    width: 110px;
    margin-top: 10px; /* Space between label and button */
  }

  /* Emoji Grid Popup */
  .emoji-grid-popup {
    position: absolute;
    top: 100%; /* Position below the trigger button */
    left: 0; /* Align to the left of the trigger button */
    z-index: 1000;
    background: #f4f4f4; /* Greish bubble background */
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: none; /* Hidden by default */
    padding: 12px;
    grid-template-columns: repeat(3, 1fr); /* Equal width for all buttons */
    gap: 10px;
    width: auto; /* Adjust width based on content */
    min-width: 240px; /* Minimum width for the grid */
  }

  /* Show the popup on hover */
  .emoji-picker-wrapper:hover .emoji-grid-popup {
    display: grid;
  }

  /* Styling for each emoji button in the grid */
  .emoji-grid-popup .emoji-button {
    padding: 10px;
    font-size: 1.5rem;
    background-color: #f4f4f4; /* Greish background */
    border: 2px solid transparent;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.2s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%; /* Take full width of the grid cell */
    height: auto; /* Adjust height based on content */
    flex-shrink: 0; /* Prevent shrinking */
  }

  /* Hover effect for emoji buttons */
  .emoji-grid-popup .emoji-button:hover {
    background-color: #e0e0e0; /* Lighter grey on hover */
  }

  /* Selected emoji button in the grid */
  .emoji-grid-popup .emoji-button.selected {
    border-color: #ac3457;
    background-color: #ffe9ef; /* Light pinkish color for selected emoji */
  }

  /* Emoji Symbol inside the button */
  .emoji-grid-popup .emoji-symbol {
    font-size: 1.8rem;
  }

  /* Emoji Label inside the button */
  .emoji-grid-popup .emoji-label {
    font-size: 0.9rem;
    color: #555;
    text-align: center;
  }
  /* Media Query */
  @media (max-width: 600px) {
    .row-combined {
      flex-direction: column;
    }

    .input-group {
      width: 100%;
    }
  }
</style>
